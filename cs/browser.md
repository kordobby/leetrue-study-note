# dasfsghjfdsafsghf

# 브라우저의 동작 과정

## 🖥️  브라우저란?

---

- 웹 브라우저(Web browser) 혹은 브라우저는 웹에서 페이지를 검색하고 표시하며 사용자가 하이퍼링크를 통해 추가 페이지에 접근할 수 있도록하는 프로그램
- naver, google 과 같은 사이트에 접속해 필요한 정보를 검색할 수 있게끔 접속을 도와주는 도구
- 브라우저는 제어판과 같이 컴퓨터에 설치되어 있는 하나의 프로그램으로 이 프로그램을 다운받고 실행하면 주소창을 입력할 수 있는 도구가 나타남!

## 📓 브라우저의 주요 기능

---

- **사용자가 선택한 자원을 서버에 요청**하고 **브라우저에 표시**하는 것

  - 사용자가 선택한 자원이란?
    - 보통 HTML 문서이지만 PDF, 이미지 또는 다른 형태가 될 수도 있음
    - 자원의 주소는 URI (Uniform Resource Identifier)에 의해 정해짐

- 브라우저는 어떻게 화면을 보여줄까?

  - HTML 과 CSS 명세에 따라 HTML 파일을 해석해서 효시하고, 이에 대한 명세는 웹 표준화 기구인 W3C(World Wide Web Consortium)에서 정함
  - 최근 대부분의 브라우저는 이 표준 명세를 따름

- 브라우저의 사용자 인터페이스의 일반적 구성
  - URI 를 입력할 수 있는 주소 표시줄
  - 이전 버튼과 다음 버튼
  - 북마크
  - 새로고침 버튼과 현재 문서의 로드를 중단할 수 있는 정지 버튼
  - 홈 버튼

## 📓 브라우저의 기본 구조

---

![스크린샷 2023-03-05 오후 10.36.27.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b6aea45a-d55f-4656-9e0d-356388112f72/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-03-05_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.36.27.png)

### 브라우저의 주요 구성 요소

- 사용자 인터페이스
- 브라우저 엔진
- 렌더링 엔진
- 통신
- UI 백엔드
- 자바스크립트 해석기
- 자료 저장소

### 사용자 인터페이스 User Interface

- 주소 표시줄, 이전 / 다음 버튼, 북마크 메뉴 등으로 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분

### 브라우저 엔진

- 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어

### 렌더링 엔진

- 요청한 컨텐츠를 표시함
  - HTML 을 요청한다면 HTML 과 CSS 를 파싱해 화면에 표시함
  - ex) WebKit, Gecko

### 통신

- HTTP 요청과 같은 네트워크 호출에 사용됨
- HTTP, HTTPS 요청을 받으면 네트워크 처리 후에 응답을 전달함 (OS에서 실행)
- 플랫폼의 독립적인 인터페이스로 각 플랫폼의 하부에서 실행됨

### UI 백엔드

- 콤보 박스와 창 같은 기본적인 장치를 그림
- 플랫폼에서 명시하지 않은 일반적인 인터페이스로, OS 사용자 인터페이스 체계를 사용
- render tree 를 브라우저에 그림

### 자바스크립트 해석기(엔진)

- 자바스크립트 코드를 해석하고 실행
  - ex) V8

### 자료 저장소

- 자료를 저장하는 계층
  - ex) Cookie, Local Storage
- 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있음
- HTML5 명세에는 브라우저가 지원하는 웹 데이터 베이스가 정의되어 있음

## 📓 렌더링 엔진

---

- 렌더링 엔진의 역할은 요청 받은 내용을 브라우저 화면에 표시하는 것
- 화면에 표시되는 내용?
  - HTML 및 XML 문서와 이미지를 표시할 수 있음
  - 브라우저 확장 기능을 이용해 PDF 와 같은 다른 유형도 표시 가능

### 렌더링 엔진의 종류

- 파이어 폭스 : 모질라에서 직접 만든 게코(Gecko) 엔진을 사용
- 사파리, 크롬 : [웹킷(Webkit)](https://webkit.org/) 엔진을 사용
  - 웹킷은 최초 리눅스 플랫폼에서 동작하기 위해 제작된 오픈소스 엔진
  - 애플이 맥과 윈도우즈에서 사파리 브라우저를 지원하기 위해 수정을 가함

### 렌더링 엔진의 동작 과정

- 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작하는데, 문서 내용은 보통 8KB 단위로 전송됨

![스크린샷 2023-03-05 오후 11.10.42.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c94cc252-cd97-4124-bae0-7a705c37f3f9/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-03-05_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.10.42.png)

- 렌더링 엔진은 HTML 문서를 파싱
  → “컨텐츠 트리” 내부에서 DOM 노드로 변환
  → 외부 CSS 파일과 함께 포함된 스타일 요소도 파싱
  → 스타일 정보와 HTML 표시 규칙은 “렌더 트리”라고 부르는 또 다른 트리를 생성
- 렌더 트리는 색상 또는 면적과 같은 시각적 속성이 있는 사각형을 포함하는데, 정해진 순서대로 화면에 표시됨
- 렌더 트리 생성이 끝나면 배치가 시작됨
  → 각 노드가 화면의 정확한 위치에 표시되는 것을 의미

### Webkit

- 오픈 소스 웹 브라우저 엔진
- 사파리 브라우저 외에도 맥의 옴니웹(Omniweb), Shiira 등의 브라우저들이 웹 페이지를 사용함
- 핸드폰에서 비교적 널리 사용됨
  - 구글 안드로이드, 애플 아이폰, 노키아 S60 의 브라우저

![스크린샷 2023-03-05 오후 11.56.17.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d0def4b3-393e-44ea-87ae-c0db833f6ae2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-03-05_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.56.17.png)

### Constructing → Attachment → Operation → Layout → Painting → Coposition

- Webkit 은 HTML 태그와 Body 태그를 처리하고 렌더 트리를 만듦

  - 렌더 트리 : 시각적 표기 계산을 하는 부분
  - 레이아웃 : 시각적 표시 계산 이후 배치 작업

- Constructing

  - 브라우저에서 최종 렌더링을 하기 위해서는 HTML, CSS 파싱 과정을 거쳐야 함
  - HTML : DOM(Document Object Model) 로 파싱
  - CSS : CSSOM(CSS Object Model) 로 파싱

- DOM, Document Object Model

  - HTML 을 브라우저가 이해할 수 있는 node 타입의 Obejct 로 변환하는 작업

- CSSOM, CSS Object Model

  - 브라우저는 DOM 을 생성하는 동안 외부 CSS 를 참조하는 <link> 태그를 만나면 리소스를 요청함
  - CSS 의 원시 바이트가 문자열로 변환된 후 차례로 토큰과 노드로 변환되며 마지막으로 CSSOM 구조를 만듦

- Attachment
  - Webkit 이 렌더 트리를 구성하기 위해 DOM 트리와 Style 을 연결하는 과정
  - 스타일을 결정하고 렌더러를 만듦
  - HTML, CSS 파싱 과정이 마친 이후, DOM 트리와 CSSOM 트리를 결합해서 렌더트리를 형성하는 과정
  - 최종 렌더트리에는 `<head>` 태그에 이용자의 눈에 보이지 않는 `<meta>`, `<link>` 노드 등은 반영되지 않음
  - CSS 에 의해 화면에서 숨겨지는 노드들은 렌더트리에 반영되지 않음
    - `display : none`
    - `visibility : hidden` 은 화면에는 보이지 않으나 자리는 차지하므로 렌더트리에 포함
- Javascript
  - 파서를 차단하는 리소스로, 문서를 파싱하다 Javascript 를 만나면 파싱을 중지하고 실행됨
    - html 문서 파싱 이전에 Javascript 가 실행이 되기에 문제가 될 수 있음
    - head 가 아닌 body 의 끝에 스크립트를 위치시키거나 async, defer 옵션을 사용해 문제 해결
- Operation
  - 브라우저는 렌더트리 구성 이후 어떠한 요소를 배치할 지 계산한 후 그림을 그림
  - 계산된 요소들의 크기를 계산해 레이아웃을 계산 이후 배치함
- Layout
  - 변환된 노드의 정확한 위치와 크기를 계산하는 과정을 뜻함
  - 상대적인 층적값으로 할당된 값들은 절대적인 px 단위로 변환이 됨
- Painting
  - Layout 작업 이후 바로 그리는 것이 아닌 각각의 부분들을 비트맵 형식으로 나누게 됨
  - 이후 레이어의 단계에 의해 준비함
  - 이러한 단계를 거치는 이유는 한 부분을 바꾸기 위해 전체적으로 바꾸지 않기 위함
  - 수정 부분이 생길 때는 레이어 단계를 나눠둔 해당 레이어만 수정하면 됨
    - 포토샵의 레이어 같은 개념
- Composition
  - 최종적으로 z-index 가 가장 높은 요소가 나중에 배치되며 나타남

> [https://developer.mozilla.org/ko/docs/Glossary/Browser](https://developer.mozilla.org/ko/docs/Glossary/Browser)
